# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 1 ‚Äî Executive Summary & Scope**
_(Part 1 of the full PRD ‚Äî more sections will follow after this.)_

---

# üü© **1.0 Executive Summary**

DevSponsor is a **developer funding & collaboration platform** where:

- **Sponsors** define software projects, generate milestones using AI, and fund them.
- **Contributors** claim sub-milestones, submit PRs, and earn **micropayments** released automatically after **AI + test harness + ZK verification**.
- The platform manages **escrow/yield**, **private repo access**, **GitHub integration**, **AI-driven workflows**, and **agent-based automation**.

DevSponsor unifies:

### **üîß Backend Technologies**

- **Node.js + TypeScript**
- **Prisma + Postgres**
- **Inngest + Inngest Agent Kit**
- **Kafka**
- **Redis**
- **Qdrant Vector DB**
- **Vercel AI SDK**
- **Claude / OpenRouter AI Models**
- **Octokit GitHub App**
- **EVM Smart Contracts (Escrow / Yield / Micropayment Vault)**

### **üß† AI Components**

- **AI Milestone Generation Agent** (Inngest + AI SDK)
- **AI Sidebar Assistant** (context-aware, project-aware)
- **AI Document Ingestion ‚Üí Vector Search Memory** (Qdrant)
- **AI Re-scoping & task refinement**
- **AI verification explanations for contributors**

### **üõ† Core Flows**

- GitHub private repo auto-invite
- Contributor task claiming
- PR ‚Üí Test Harness ‚Üí Digest ‚Üí ZK ‚Üí Micropayment release
- Yield mode handling (Aave/Compound)
- Platform fee collection
- Notifications (email + in-app bell)
- Real-time WebSockets

This PRD describes **the full engineered system required to ship DevSponsor end-to-end**.

---

# üü¶ **1.1 Product Vision**

To create the **future of open-source and private development collaboration**, where:

- AI eliminates friction in planning and scoping.
- Contributors are rewarded instantly, based on verifiable work.
- Sponsors invest into work, not promises.
- Payments flow transparently through smart contracts.
- Agents automate project management, progress tracking, and milestone planning.

DevSponsor aims to become the **Stripe for developer funding** + **Flexport for developer management** + **Ava Labs-style yield pools** + **OpenAI/Vercel-style AI agents integrated into developer workflow**.

---

# üü™ **1.2 Goals**

### **üéØ Primary Goals**

- AI-first milestone creation and project scoping.
- Autonomous PR verification using deterministic test harness + ZK proofs.
- Secure and automated micropayment release.
- Full repo access management for private and public repos.
- Strong notification system for all critical events.
- Scalable architecture based on Inngest, Kafka, and AI SDK.

### **üéØ Secondary Goals**

- Reduce sponsor friction (no budget input; price auto-calculated).
- Provide transparent earnings dashboard for contributors.
- Deliver a stable yield mode with predictable platform fees.
- Offer an AI assistant visible on all screens, with task-aware responses.

---

# üü• **1.3 Non-Goals (Out of Scope)**

These are explicitly **excluded** from v1:

‚ùå No AI code-writing inside tasks (completion, not generation).
‚ùå No mobile app (mobile-optimized web only).
‚ùå No project-level chat (only notifications + AI assistant).
‚ùå No multi-chain support (only EVM for now).
‚ùå No cross-project milestone syncing.

---

# üü© **1.4 Key Definitions**

| Term                      | Definition                                                                                          |
| ------------------------- | --------------------------------------------------------------------------------------------------- |
| **Sponsor**               | A user creating organizations, projects, funding work.                                              |
| **Contributor**           | A user completing sub-milestones and receiving micropayments.                                       |
| **Milestone**             | A major project division generated by AI.                                                           |
| **Sub-milestone**         | A single task/PR-sized unit of work (payable).                                                      |
| **Points**                | AI-estimated complexity metric ‚Üí convertible to token amount.                                       |
| **Funding Mode**          | Escrow or Yield (Aave/Compound).                                                                    |
| **AI Milestone Agent**    | The Inngest-powered agent generating milestones.                                                    |
| **AI Sidebar Assistant**  | Context-aware AI helper embedded in UI.                                                             |
| **Private Repo Access**   | GitHub App automatically invites contributors to a private repo when they are invited to a project. |
| **Verification Pipeline** | PR ‚Üí Test Harness ‚Üí ZK ‚Üí Micropayment release.                                                      |
| **Inngest**               | Workflow orchestrator for long-running, reliable background jobs.                                   |
| **Qdrant**                | Vector DB for embeddings & AI memory retrieval.                                                     |

---

# üü¶ **1.5 System Boundaries**

### **Inbound Inputs**

- GitHub Webhooks
- AI model responses
- Smart contract events
- User actions (Sponsor, Contributor)
- Document uploads
- Inngest workflow triggers
- Kafka events

### **Outbound Systems**

- GitHub API (auto-invite, PR checks, repo metadata)
- Smart contract transactions
- AI SDK model calls
- Email provider
- WebSocket events
- Kafka topics

---

# üü® **1.6 Target Users**

### **Sponsor Persona**

- Engineering manager
- Startup founder
- Company contracting external developers
- Open-source project maintainer
  Needs: Transparent development, milestone clarity, yield on idle funds.

### **Contributor Persona**

- Freelance developer
- Open-source contributor
- Junior dev learning
  Needs: Small tasks, instant payments, AI guidance, and repo access ease.

---

# üü© **1.7 Supported Scenarios**

### ‚úî Creating an org ‚Üí project ‚Üí AI milestones

### ‚úî Editing milestones ‚Üí auto-calculated funding

### ‚úî Funding via wallet

### ‚úî Private repo access via auto GitHub collaborator invite

### ‚úî Contributor claims task

### ‚úî AI + agent runs deterministic test harness

### ‚úî ZK proof generated and micropayment released

### ‚úî Notifications sent (email + in-app bell)

### ‚úî AI sidebar assists with task, project context, or debugging

---

# üü• **1.8 Constraints**

- All AI features must use **Vercel AI SDK** (strict requirement).
- Milestone generation must use **Inngest Agent Kit** for background tasks.
- PR verification pipeline must be deterministic and reproducible.
- No Sponsor-input funding amount allowed.
- All access to private repos requires GitHub App collaborator invite.
- All notifications must be stored in DB + displayed in UI.

---

# üü¶ **1.9 Success Metrics (KPIs)**

| KPI                             | Target                 |
| ------------------------------- | ---------------------- |
| AI milestone generation success | 99%                    |
| PR verification time            | < 3 min median         |
| Payment release accuracy        | 100%                   |
| Private repo invite sync        | 100%                   |
| AI Sidebar latency              | < 1 sec (stream start) |
| Workflow failures               | < 0.01%                |
| SLA uptime                      | 99.95%                 |

---

# ‚úî Section 1 Completed

Next I will deliver:

# **Section 2 ‚Äî System Architecture**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 2 ‚Äî System Architecture**
_(Part 2 of the full PRD ‚Äî extremely detailed, end-to-end architecture overview.)_

---

# üü¶ **2.0 System Architecture Overview**

DevSponsor is a **distributed, event-driven, AI-orchestrated backend system** built on:

- **Node.js + TypeScript** (primary backend runtime)
- **Postgres + Prisma** (relational database)
- **Qdrant** (vector database)
- **Kafka** (event bus)
- **Redis** (cache + rate limiter + pub/sub)
- **Inngest** (workflow engine + background jobs)
- **Inngest Agent Kit** (AI agent automation)
- **Vercel AI SDK** (LLM gateway)
- **GitHub App + Octokit** (repo integration)
- **Smart Contracts (EVM)** (escrow, yield, micropayment vault)
- **WebSockets** (real-time client events)
- **Email provider** (notifications)

This architecture supports:

- Private & public repo handling
- Automated milestone generation
- AI assistance everywhere
- Full PR verification pipeline
- Secure micropayment release
- Background workflows & long-running agents
- Multi-source triggers & eventual consistency

---

# üü© **2.1 High-Level Architecture Diagram (Conceptual)**

```
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ        Frontend          ‚îÇ
                   ‚îÇ  Next.js / React / WS    ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                             HTTPS + WS
                                  ‚îÇ
             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
             ‚îÇ              API GATEWAY                ‚îÇ
             ‚îÇ   (Node.js + Express/Fastify, MVC)      ‚îÇ
             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                                  ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ       Controllers         ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚îÇ
                                  ‚ñº
                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                      ‚îÇ     Services     ‚îÇ
                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ      ‚îÇ
                             ‚îÇ      ‚îÇ
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚ñº                             ‚ñº
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ   Inngest Workflows   ‚îÇ       ‚îÇ   AI Orchestrator ‚îÇ
       ‚îÇ  Inngest Agent Kit    ‚îÇ       ‚îÇ  (Vercel AI SDK)  ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                   ‚îÇ                               ‚îÇ
                   ‚ñº                               ‚ñº
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ   Kafka Event Bus    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  GitHub App / Octokit  ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ                                 ‚îÇ
                  ‚ñº                                 ‚ñº
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ Postgres (Prisma)  ‚îÇ             ‚îÇ   Smart Contracts (EVM) ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ   Qdrant Vector   ‚îÇ
                  ‚îÇ  DB (AI Memory)   ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ   Redis Cache     ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                  ‚îÇ Email Provider    ‚îÇ
                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

# üü• **2.2 Architecture Principles**

| Principle                      | Meaning                                                                                                              |
| ------------------------------ | -------------------------------------------------------------------------------------------------------------------- |
| **AI-first architecture**      | Milestones, context reasoning, document summarization, re-scoping and task support handled by AI agents via Inngest. |
| **Event-driven**               | All major actions emit Kafka events.                                                                                 |
| **Async-first**                | Long-running flows (AI, verification, ZK, payments) run in Inngest workflows.                                        |
| **Deterministic verification** | PR verification uses reproducible environments; proofs are verifiable.                                               |
| **Zero-trust repo access**     | Private repos require GitHub collaborator invites issued automatically via the GitHub App.                           |
| **Composable services**        | Each subsystem is isolated behind service layers.                                                                    |
| **Auditable by design**        | Every AI interaction, prompt, and response is stored with checksums.                                                 |
| **Scalable**                   | Kafka + Inngest enabling horizontal scaling of agents.                                                               |

---

# üü© **2.3 Backend Subsystems (Detailed)**

DevSponsor backend consists of **12 major subsystems**:

---

## **2.3.1 API Gateway (Node.js + Express/Fastify)**

- Receives all HTTP requests
- Validates auth (JWT + GitHub OAuth)
- Delegates to controllers
- Streams AI responses to frontend (via AI SDK)
- Publishes events to Kafka
- Returns structured JSON

**Responsibilities:**

- Authentication middleware
- Rate limiting
- Signature verification (GitHub webhooks)
- GitHub OAuth callback

---

## **2.3.2 Controllers (Pure routing logic)**

Every route is separated from business logic:

```
routes/
controllers/
services/
```

Examples:

- `OrgController`
- `ProjectController`
- `MilestoneController`
- `FundingController`
- `TaskController`
- `NotificationController`

Controllers must **never** call models or AI directly ‚Äî only via services.

---

## **2.3.3 Services (Business Logic Layer)**

All application logic lives here.

### Core services:

| Service                 | Responsibilities                               |
| ----------------------- | ---------------------------------------------- |
| **OrgService**          | Create orgs, invite members, permissions       |
| **ProjectService**      | Create/edit project metadata                   |
| **MilestoneService**    | Retrieve/edit milestones                       |
| **AIService**           | All AI interactions via Vercel AI SDK          |
| **FundingService**      | Token conversion, deposit instructions         |
| **TaskService**         | Claim tasks, PR linking, contributor flows     |
| **VerificationService** | PR ‚Üí test harness ‚Üí digest generation          |
| **ZKService**           | Generate ZK proofs, submit proofs              |
| **PaymentService**      | Issue micropayments through contracts          |
| **InviteService**       | Platform invites + GitHub collaborator invites |
| **NotificationService** | Email + in-app notifications                   |
| **DocumentService**     | File upload, embeddings, Qdrant indexing       |
| **RepoService**         | GitHub API calls, repo visibility logic        |

---

## **2.3.4 Inngest Workflows & Agent Kit**

Inngest powers:

- AI milestone generation
- PR verification
- ZK proof generation
- Micropayment flows
- Yield harvesting
- Notifications batching
- Document ingestion pipeline

### Why Inngest?

- Durable retries
- Idempotent execution
- Parallel fan-out & fan-in
- Automatic state checkpointing
- Perfect for long-running AI tasks

### Inngest Agent Kit usage:

For building **stateful agents**:

- Milestone Agent
- Verification Orchestrator
- AI Assistant Context Agent
- Repo Change Watcher Agent

These agents maintain memory via Qdrant + Postgres.

---

## **2.3.5 Kafka Event Bus**

Used for decoupling and horizontal scaling.

### Core Kafka Topics:

- `ai.milestones.generated`
- `project.created`
- `project.funded`
- `repo.private.invite.required`
- `pr.linked`
- `verification.job.created`
- `verification.job.completed`
- `zk.proof.created`
- `payment.completed`
- `yield.harvested`
- `notification.triggered`

Kafka ensures **eventual consistency** and enables **multi-consumer services**.

---

## **2.3.6 Qdrant Vector Database**

Used for:

- Document embedding
- Task context retrieval
- Project memory
- Contributor-specific prompts
- AI sidebar reasoning
- Milestone generation context

Each document uploaded is embedded using **OpenAI/Claude embeddings via AI SDK**, then inserted into Qdrant.

---

## **2.3.7 AI Orchestration Layer (Vercel AI SDK)**

All AI calls go through a dedicated AI service wrapper.

### Responsibilities:

- Streaming responses for UI (AI sidebar)
- Structured JSON generation for milestone creation
- Safety validation (schema enforcement)
- Fallback model selection (Claude ‚Üí OpenRouter ‚Üí fallback)
- Prompt enrichment via Qdrant
- Logging + auditing

---

## **2.3.8 GitHub App Integration (Octokit)**

Your GitHub App must have:

- Read/write access to repos
- Permission to **add collaborators**
- Permission to read commit status
- Webhook events

### Required Webhooks:

- `pull_request`
- `push`
- `workflow_job`
- `check_run`

### For private repos:

When Sponsor invites contributor ‚Üí
Platform calls GitHub App API ‚Üí
User receives GitHub repo invite automatically.

---

## **2.3.9 Smart Contract Layer (EVM)**

### Contracts:

- **ProjectEscrow**
- **YieldManager**
- **MicropaymentVault**
- **PlatformTreasury**

### Features:

- Deposit token
- Auto-calculated deposit amount
- Claim sub-milestone payout
- Release micropayment
- Harvest yield
- Send fee shares to treasury

Smart contracts emit events consumed by:

- Kafka
- Inngest workflows
- Real-time WebSocket updates

---

## **2.3.10 Redis Cache & Pub/Sub**

Used for:

- Session caching
- Real-time notifications
- Rate limiting
- Feature flags
- Task lock (claim prevention)
- Deduping Inngest jobs

---

## **2.3.11 WebSocket Gateway (Socket.io)**

Channels:

- `user:{userId}`
- `project:{projectId}`
- `task:{subMilestoneId}`

Events:

- Milestone updated
- Payment released
- PR verification state
- Invite accepted
- Repo access granted
- Yield harvested
- AI assistant updates

---

## **2.3.12 Email Notification Service**

Emails sent for:

- Invite to org
- Invite to private repo project
- Repo collaborator invite
- Task claimed
- PR verification complete
- Micropayment released
- Milestone updates
- AI-generated milestone ready
- Funding required
- Payment successful

Provider examples:

- Resend
- Sendgrid
- Mailgun

---

# üü¶ **2.4 MVC Folder Structure (Required)**

```
src/
 ‚îú‚îÄ routes/
 ‚îú‚îÄ controllers/
 ‚îú‚îÄ services/
 ‚îú‚îÄ inngest/
 ‚îÇ    ‚îú‚îÄ workflows/
 ‚îÇ    ‚îú‚îÄ agents/
 ‚îú‚îÄ kafka/
 ‚îÇ    ‚îú‚îÄ producers/
 ‚îÇ    ‚îú‚îÄ consumers/
 ‚îú‚îÄ prisma/
 ‚îú‚îÄ ai/
 ‚îÇ    ‚îú‚îÄ orchestrator/
 ‚îÇ    ‚îú‚îÄ prompts/
 ‚îÇ    ‚îú‚îÄ embeddings/
 ‚îú‚îÄ vectors/ (Qdrant client)
 ‚îú‚îÄ notifications/
 ‚îÇ    ‚îú‚îÄ email/
 ‚îÇ    ‚îú‚îÄ inapp/
 ‚îú‚îÄ blockchain/
 ‚îú‚îÄ github/
 ‚îú‚îÄ utils/
 ‚îî‚îÄ config/
```

This enforces strong separation of concerns.

---

# ‚úî Section 2 Completed

Next I will deliver:

# **Section 3 ‚Äî Functional Requirements**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 3 ‚Äî Functional Requirements**
_(Part 3 ‚Äî most important section; every behavior of the system is defined in detail.)_

---

# üü¶ **3.0 Functional Requirements Overview**

This section describes **every functional behavior** required to build DevSponsor end-to-end, covering:

- Sponsor flows
- Contributor flows
- Invite system
- AI systems
- Repo logic
- Funding logic
- PR verification & ZK pipeline
- Micropayments
- Notifications
- Admin tools
- Access control

Every requirement is **backend-enforced**, deterministic, and consistent.

---

# üü© **3.1 Sponsor Functional Requirements**

Sponsor = user with **SPONSOR** role.

---

## **3.1.1 Sponsor Registration**

### Requirements:

- Must authenticate using **GitHub OAuth**.
- After login, user selects role: _Sponsor_ or _Contributor_.
- Role is stored in database.
- User can switch roles later (dual roles allowed).

---

## **3.1.2 Organization Creation**

### Requirements:

- Sponsor can create unlimited orgs.
- Org can have:
  - name (required)
  - logo (optional)
  - description (optional)

- Sponsor becomes **Owner** of the org.
- Owner can invite:
  - co-sponsors
  - maintainers
  - internal contributors

### Permissions:

| Action          | Owner | Maintainer | Contributor |
| --------------- | ----- | ---------- | ----------- |
| Create project  | ‚úî    | ‚úî         | ‚úñ          |
| Invite members  | ‚úî    | ‚úî         | ‚úñ          |
| Remove members  | ‚úî    | ‚úî         | ‚úñ          |
| Manage settings | ‚úî    | ‚úî         | ‚úñ          |

---

## **3.1.3 Project Creation**

### Requirements:

Fields:

- Project title
- Description / prompt for AI
- Token selection (ERC20/native)
- Funding mode (Escrow or Yield)
- Repo selection (public or private)

### Repo states:

| Repo Type | Visibility                  | Invite Required                                              |
| --------- | --------------------------- | ------------------------------------------------------------ |
| Public    | Visible to all contributors | No                                                           |
| Private   | Hidden from dashboards      | Yes (Platform invite + GitHub repo collaborator auto-invite) |

### After creation:

- Project enters **Draft** state.
- Sponsor is redirected to AI milestone generation page.

---

## **3.1.4 AI Milestone Generation**

### Requirements:

- Uses **Inngest workflow** + **Inngest Agent Kit** + **Vercel AI SDK**.
- AI generates:
  - Milestones
  - Sub-milestones
  - Points
  - Acceptance criteria
  - Verification rules
  - Optional time estimates

- AI uses:
  - Project description
  - Uploaded documents
  - Repo README / file structure (if public)
  - Qdrant vector memory

- AI output must be:
  - structured JSON
  - schema-validated
  - stored in DB
  - shown as _Draft_ (editable)

### Sponsor actions:

- Edit milestones
- Re-run generation
- Delete certain items
- Approve structure

---

## **3.1.5 Funding (No Budget Input)**

### Requirement:

**Sponsor does NOT enter any budget manually.**

Total required payment =

```
SUM(sub_milestone.points)
√ó POINT_TO_USDC_RATE
√∑ TOKEN_PRICE_USDC
```

System must:

- fetch token price via oracle
- compute total required token amount
- store the rate + timestamp

### After calculation:

- Sponsor connects wallet
- Approves token (ERC20 only)
- Calls `deposit()` on escrow contract

Once deposit confirmed:

- Project becomes **Active**

---

## **3.1.6 Project Management**

Tabs:

### 1. Overview

- Budget
- Remaining funds
- Token
- Yield growth
- Burn rate
- Task activity

### 2. Milestones

Sponsor can:

- Freeze milestones
- Approve/reject re-scope requests
- Regenerate milestones partially (AI)
- View AI-suggested improvements

### 3. Contributors

Sponsor can:

- View active contributors
- View PRs
- Remove contributors
- Assign specific contributors to specific tasks

### 4. Funding

Sponsor can:

- Deposit more funds
- Claim leftover funds (if allowed)
- Switch mode (Escrow ‚Üî Yield)
- View fees

---

# üü© **3.2 Contributor Functional Requirements**

Contributor = user with **CONTRIBUTOR** role.

---

## **3.2.1 Registration**

- Login via GitHub OAuth.
- Select _Contributor_ during onboarding.
- Platform fetches:
  - GitHub username
  - GitHub avatar
  - Public email (if available)

---

## **3.2.2 Browsing Projects**

### Requirements:

- Public repo projects are visible.
- Private repo projects:
  - **Not** visible in dashboard.
  - Visible only after Sponsor invites contributor to project.
  - GitHub collaborator access is auto-granted.

Project preview shows:

- Milestones
- Sub-milestones with reward points
- Token payout
- Acceptance criteria summary

---

## **3.2.3 Claiming Sub-milestone**

Flow:

1. Contributor clicks ‚ÄúClaim Task‚Äù
2. Backend checks:
   - Project is funded
   - Task is not claimed by others
   - Contributor has required repo access

3. Task status ‚Üí ‚ÄúClaimed‚Äù
4. Contributor must:
   - Select repo (if multiple allowed)
   - Auto-create branch OR link existing one

### Restrictions:

- Contributor cannot claim more than configured number of tasks at once (default: 3).

---

## **3.2.4 PR Linking**

Contributor must:

- Push changes to branch
- Create or link PR inside platform
- Platform validates:
  - PR is associated with correct repo
  - PR contains commits after claim timestamp

Once linked:

- Kafka event emitted ‚Üí `pr.linked`
- Inngest workflow begins verification

---

## **3.2.5 Task Workbench**

Shows:

- Task title
- Description
- Acceptance criteria
- Timeline (Claimed ‚Üí In progress ‚Üí Under Verification ‚Üí Completed)
- GitHub commits (periodic fetch)
- PR link
- Verification checkpoints
- ZK proof status
- Micropayment logs

Embedding sidebar:

- AI explanations on errors
- AI debugging help
- AI doc context from Qdrant

---

## **3.2.6 Contributor Earnings**

Page shows:

- Total earned tokens
- Micropayment transactions
- Smart contract tx hashes
- ZK proof receipts
- Estimated yield bonus (if platform rewards contributors)

---

# üü© **3.3 Invite System Requirements (Critical)**

### Two layers:

## **3.3.1 Organization-Level Invites**

Sponsor can invite:

- Co-sponsors
- Maintainers
- Internal contributors

Invitation includes:

- Email
- Role
- Optional message

User receives:

- Email notification
- In-app notification

---

## **3.3.2 Project-Level Invites**

### For Public Repos:

- Only platform invite is required (no GitHub invite).

### For Private Repos:

When sponsor invites a contributor:

1. Platform sends normal invite ‚Üí stored in DB.
2. On acceptance:
   - Backend uses **GitHub App**:
   - **Automatically adds contributor as collaborator to repo**.

### Requirements:

- Must handle rate limits
- Must check if user exists in GitHub
- Must check if user already has access
- Must re-sync if invite expires

---

# üü¶ **3.4 Repo Visibility Rules**

| Condition                                                 | Visible to contributor? | Task claim allowed? |
| --------------------------------------------------------- | ----------------------- | ------------------- |
| Public repo                                               | ‚úî visible              | ‚úî allowed          |
| Private repo + not invited                                | ‚úñ hidden               | ‚úñ denied           |
| Private repo + invited (platform only)                    | ‚úñ hidden               | ‚úñ denied           |
| Private repo + invited (platform + GitHub access granted) | ‚úî visible              | ‚úî allowed          |

Backend enforces both platform + GitHub access.

---

# üü© **3.5 AI Functional Requirements**

## **3.5.1 AI Milestone Agent**

Powered by:

- Inngest workflow
- Inngest Agent Kit
- Vercel AI SDK

Inputs:

- Project description
- Uploaded documents
- Repo structure
- README
- Past milestones (if regenerating)
- Qdrant memory

Output:

- Milestones
- Sub-milestones
- Points
- Acceptance criteria
- Verification rules
- Optional estimated hours

All outputs must:

- Pass JSON schema validation
- Be stored in DB
- Be versioned
- Be editable

---

## **3.5.2 AI Sidebar Assistant**

Always available on:

- Project pages
- Task pages
- Milestone editing
- AI milestone generation
- Contributor workbench

Capabilities:

- Summaries
- Question answering
- Debugging help
- PR explanation
- Repo analysis
- Document retrieval
- Acceptance criteria breakdown

Uses:

- User message
- Active context (project/subtask)
- Qdrant vector search
- Past conversation (task-scoped only)

---

## **3.5.3 AI Rescoping & Task Revision**

Contributor can request:

- Task clarification
- Re-scoping
- Acceptance criteria changes

AI proposes:

- Updated points
- Updated description

Sponsor must approve.

---

## **3.5.4 AI Document Ingestion**

When contributor uploads docs:

- File is parsed
- Split into chunks
- Embedded
- Stored in Qdrant
- Linked to project/task

---

# üü© **3.6 PR Verification & ZK Pipeline**

## Steps:

### **1. PR Linked**

Event emitted: `pr.linked`.

### **2. Test Harness Execution**

Inngest workflow:

- Clone repo
- Checkout PR branch
- Install dependencies (locked + cached)
- Run deterministic tests
- Generate digest + merkle leaf

### **3. ZK Proof Generation**

- Use ZK circuits to prove:
  - Tests ran on this code
  - Output is valid
  - Digest is correct

### **4. Submit Proof**

- Upload proof to chain
- Smart contract validates

### **5. Micropayment Release**

- Smart contract releases token to contributor
- Event emitted
- WebSocket pushes update

---

# üü© **3.7 Payments & Funding**

### No budget input

Total funding is calculated from points.

### Payment triggered when:

- ZK proof is verified
- Smart contract emits ‚ÄúPaymentReleased‚Äù

### Platform fees:

- Yield fees
- Micropayment fees
- Configurable via environment

---

# üüß **3.8 Notifications Requirements**

### Notification Types:

- Invite
- PR linked
- Verification pending
- Verification success
- Payment sent
- AI milestone ready
- Repo access granted
- Task claimed
- Task approved
- Yield harvested

### Delivery:

- Email
- In-app bell
- WebSocket

All notifications stored in DB.

---

# üü• **3.9 Access Control**

### Roles:

- Sponsor
- Contributor
- OrgOwner
- Maintainer
- Admin

### Resource access rules:

Defined per entity.

---

# ‚úî Section 3 Completed

# **Section 4 ‚Äî Data Models & ERD**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 4 ‚Äî Data Models & ERD**
_(Part 4 of the full PRD ‚Äî complete data modeling, Prisma schema specification, entity descriptions, and Qdrant vector memory design.)_

---

# üü¶ **4.0 Overview**

This section defines:

1. **All database entities**
2. **Relationships**
3. **Indexes & constraints**
4. **Access rules per entity**
5. **Qdrant vector store schema**

Data storage principles:

- All structured data ‚Üí **Postgres (Prisma)**
- All embeddings / AI memory ‚Üí **Qdrant**
- All large files ‚Üí **Cloud object storage (S3/GCP/etc.)**
- All workflow metadata ‚Üí Inngest state store
- All event streams ‚Üí Kafka topics

---

# üü© **4.1 ERD (Entity Relationship Diagram)**

_(Textual representation due to chat format)_

```
User
 ‚îú‚îÄ Wallet[]
 ‚îú‚îÄ Organizations (via OrgMember)
 ‚îú‚îÄ Contributions (SubMilestones)
 ‚îî‚îÄ Notifications[]

Organization
 ‚îú‚îÄ Members (OrgMember)
 ‚îú‚îÄ Projects
 ‚îî‚îÄ Ownership (User.ownerId)

OrgMember
 ‚îú‚îÄ userId
 ‚îú‚îÄ orgId
 ‚îî‚îÄ role (OWNER | MAINTAINER | CONTRIBUTOR | SPONSOR)

Project
 ‚îú‚îÄ Organization
 ‚îú‚îÄ Milestones[]
 ‚îú‚îÄ Funding records[]
 ‚îú‚îÄ Repo metadata
 ‚îî‚îÄ Invite[]

Milestone
 ‚îú‚îÄ Project
 ‚îú‚îÄ SubMilestones[]
 ‚îî‚îÄ Version history

SubMilestone
 ‚îú‚îÄ Milestone
 ‚îú‚îÄ ClaimedBy (User)
 ‚îú‚îÄ ZkProof[]
 ‚îú‚îÄ Payments[]
 ‚îî‚îÄ PR link metadata

Invite
 ‚îú‚îÄ FromSponsor (User)
 ‚îú‚îÄ ToUser (User)
 ‚îú‚îÄ projectId / orgId
 ‚îú‚îÄ status (PENDING/ACCEPTED/EXPIRED)
 ‚îî‚îÄ githubInvitationState

ZkProof
 ‚îú‚îÄ SubMilestone
 ‚îî‚îÄ On-chain proof metadata

Payment
 ‚îú‚îÄ SubMilestone
 ‚îî‚îÄ Token info, tx hash, amount

Notification
 ‚îî‚îÄ User, status (READ/UNREAD)

Document
 ‚îú‚îÄ Project
 ‚îî‚îÄ Qdrant references

FundingRecord
 ‚îú‚îÄ Project
 ‚îî‚îÄ deposit info

GitHubRepoAccess
 ‚îú‚îÄ userId
 ‚îú‚îÄ projectId
 ‚îî‚îÄ githubInviteStatus (SENT/ACCEPTED/PENDING)
```

---

# üü¶ **4.2 Full Database Model Specification (Conceptual)**

_(No code, but defines schema exactly as needed for implementation.)_

---

## **4.2.1 User**

| Field     | Type          | Notes                        |
| --------- | ------------- | ---------------------------- |
| id        | String (cuid) | Primary key                  |
| githubId  | String        | Unique                       |
| username  | String        | GitHub username              |
| email     | String        | Nullable                     |
| avatarUrl | String        | GitHub avatar                |
| roles     | UserRole[]    | SPONSOR / CONTRIBUTOR / BOTH |
| createdAt | DateTime      |                              |
| updatedAt | DateTime      |                              |

### Relationships:

- 1:N Wallet
- 1:N Notifications
- N:M Organizations (via OrgMember)
- N:M Project invites
- 1:N Claimed SubMilestones

---

## **4.2.2 Wallet**

| Field     | Type     | Notes                   |
| --------- | -------- | ----------------------- |
| id        | String   | cuid                    |
| userId    | String   | FK(User)                |
| address   | String   | Wallet address          |
| chain     | String   | ethereum / polygon etc. |
| createdAt | DateTime |                         |

---

## **4.2.3 Organization**

| Field       | Type     | Notes           |
| ----------- | -------- | --------------- |
| id          | String   | cuid            |
| ownerId     | String   | FK(User)        |
| name        | String   | Unique per user |
| logoUrl     | String?  |                 |
| description | String?  |                 |
| createdAt   | DateTime |                 |

---

## **4.2.4 OrgMember**

| Field     | Type     | Notes                                      |
| --------- | -------- | ------------------------------------------ |
| id        | cuid     |                                            |
| orgId     | FK       | Organization                               |
| userId    | FK       | User                                       |
| role      | enum     | OWNER / MAINTAINER / SPONSOR / CONTRIBUTOR |
| addedById | FK       | User who invited                           |
| createdAt | DateTime |                                            |

---

## **4.2.5 Project**

| Field            | Type     | Notes                            |
| ---------------- | -------- | -------------------------------- |
| id               | cuid     |                                  |
| orgId            | FK       | Organization                     |
| title            | String   |                                  |
| description      | String   |                                  |
| repoUrl          | String   |                                  |
| repoType         | enum     | PUBLIC / PRIVATE                 |
| tokenAddress     | String?  | If null ‚Üí native token           |
| tokenDecimals    | Int      |                                  |
| fundingMode      | enum     | ESCROW / YIELD                   |
| platformFeePct   | Float    |                                  |
| totalPoints      | Int      | Updated after milestone approval |
| totalTokenAmount | Decimal  | Token calculated at funding      |
| state            | enum     | DRAFT / ACTIVE / COMPLETED       |
| createdAt        | DateTime |                                  |
| updatedAt        | DateTime |                                  |

---

## **4.2.6 Milestone**

| Field              | Type     | Notes                               |
| ------------------ | -------- | ----------------------------------- |
| id                 | cuid     |                                     |
| projectId          | FK       |                                     |
| title              | String   |                                     |
| description        | Text     |                                     |
| points             | Int      |                                     |
| acceptanceCriteria | Json     |                                     |
| verificationRules  | Json     | AI rules for PR verification        |
| order              | Int      |                                     |
| status             | enum     | DRAFT / ACTIVE / FROZEN / COMPLETED |
| createdAt          | DateTime |                                     |

---

## **4.2.7 SubMilestone**

| Field        | Type     | Notes                                                      |
| ------------ | -------- | ---------------------------------------------------------- |
| id           | cuid     |                                                            |
| milestoneId  | FK       |                                                            |
| title        | String   |                                                            |
| description  | Text     |                                                            |
| points       | Int      |                                                            |
| payoutAmount | Decimal  | auto-calculated                                            |
| status       | enum     | OPEN / CLAIMED / IN_PROGRESS / VERIFYING / VERIFIED / PAID |
| claimedById  | FK       | nullable                                                   |
| prUrl        | String?  |                                                            |
| branchName   | String?  |                                                            |
| createdAt    | DateTime |                                                            |
| updatedAt    | DateTime |                                                            |

---

## **4.2.8 Invite (Organization + Project)**

| Field                | Type     | Notes                               |
| -------------------- | -------- | ----------------------------------- |
| id                   | cuid     |                                     |
| fromUserId           | FK(User) |                                     |
| toUserId             | FK(User) |                                     |
| orgId                | FK       | nullable                            |
| projectId            | FK       | nullable                            |
| githubInviteStatus   | enum     | NOT_SENT / SENT / ACCEPTED / FAILED |
| platformInviteStatus | enum     | PENDING / ACCEPTED / DECLINED       |
| createdAt            | DateTime |                                     |

---

## **4.2.9 GitHubRepoAccess**

Tracks the per-project GitHub collaborator state.

| Field              | Type        | Notes                               |
| ------------------ | ----------- | ----------------------------------- |
| id                 | cuid        |                                     |
| userId             | FK(User)    |                                     |
| projectId          | FK(Project) |                                     |
| accessState        | enum        | NONE / INVITE_SENT / ACCESS_GRANTED |
| githubInvitationId | String?     | GitHub invitation ID                |
| createdAt          | DateTime    |                                     |

---

## **4.2.10 ZkProof**

| Field          | Type     | Notes                             |
| -------------- | -------- | --------------------------------- |
| id             | cuid     |                                   |
| subMilestoneId | FK       |                                   |
| proofData      | JSON     |                                   |
| txHash         | String?  | On-chain verification transaction |
| status         | enum     | PENDING / VERIFIED / FAILED       |
| createdAt      | DateTime |                                   |

---

## **4.2.11 Payment**

| Field          | Type        | Notes    |
| -------------- | ----------- | -------- |
| id             | cuid        |          |
| subMilestoneId | FK          |          |
| amount         | Decimal     |          |
| tokenAddress   | String      |          |
| txHash         | String?     |          |
| proofId        | FK(ZkProof) | optional |
| releasedAt     | DateTime    |          |

---

## **4.2.12 Notification**

| Field     | Type     | Notes                                     |
| --------- | -------- | ----------------------------------------- |
| id        | cuid     |                                           |
| userId    | FK(User) |                                           |
| type      | enum     | INVITE / PR_LINKED / PAYMENT / YIELD etc. |
| title     | String   |                                           |
| message   | Text     |                                           |
| metadata  | JSON     |                                           |
| read      | Boolean  |                                           |
| createdAt | DateTime |                                           |

---

## **4.2.13 FundingRecord**

| Field         | Type     | Notes          |
| ------------- | -------- | -------------- |
| id            | cuid     |                |
| projectId     | FK       |                |
| amount        | Decimal  |                |
| token         | String   |                |
| mode          | enum     | ESCROW / YIELD |
| depositTxHash | String   |                |
| oracleRate    | Decimal  |                |
| createdAt     | DateTime |                |

---

## **4.2.14 Document**

| Field        | Type     | Notes                                |
| ------------ | -------- | ------------------------------------ |
| id           | cuid     |                                      |
| projectId    | FK       |                                      |
| fileUrl      | String   |                                      |
| type         | enum     | MARKDOWN / PDF / TEXT / CODE / OTHER |
| vectorRefIds | String[] | list of Qdrant points                |
| createdAt    | DateTime |                                      |

---

# üü¶ **4.3 Required Indexes**

| Table            | Index                | Purpose             |
| ---------------- | -------------------- | ------------------- |
| User             | githubId (unique)    | Fast lookup         |
| OrgMember        | orgId + userId       | Validate membership |
| Project          | orgId                | Fetch org projects  |
| Project          | repoUrl              | GitHub sync         |
| Milestone        | projectId            | Query milestones    |
| SubMilestone     | milestoneId          | List sub-tasks      |
| Invite           | toUserId + projectId | Prevent duplicates  |
| GitHubRepoAccess | userId + projectId   | Repo access control |

---

# üü© **4.4 Qdrant Vector Store Schema**

Qdrant will store:

### **Collections**

---

## **4.4.1 project_documents**

Used for:

- Milestone generation context
- AI sidebar context
- Task-specific reasoning

### Fields:

| Field        | Type                         |
| ------------ | ---------------------------- |
| projectId    | string                       |
| contentChunk | string                       |
| embedding    | vector<float> (1536 or 3072) |
| metadata     | JSON (file info, page info)  |

### Indexes:

- `projectId`
- `metadata.filename`
- vector index (HNSW)

---

## **4.4.2 task_context**

Used by AI sidebar for contributor tasks.

| Field          | Type   |
| -------------- | ------ |
| subMilestoneId | string |
| codeChunk      | string |
| embedding      | vector |
| metadata       | JSON   |

---

## **4.4.3 repo_embeddings**

Generated from:

- README
- Repo docs
- Code summaries

Fields:

- repoUrl
- filePath
- chunk
- embedding

---

# üü¶ **4.5 Audit Log Requirements**

For every AI action:

- store prompt
- store model name
- store temperature
- store result
- store checksum

For every payment:

- store payout inputs
- calculated amount
- txHash

For every GitHub invite:

- GitHub invite ID
- GitHub API response

---

# ‚úî Section 4 Completed

# **Section 5 ‚Äî API Specifications (End-to-End REST + Webhooks + WebSocket Events)**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 5 ‚Äî API Specifications (REST + Webhooks + WebSockets)**
_(Part 5 ‚Äî complete backend API design. No code, only conceptual schemas and deep specification.)_

---

# üü¶ **5.0 Overview**

This section defines:

- **REST API endpoints**
- **Endpoint semantics & responsibilities**
- **Authentication & scope rules**
- **GitHub webhook contracts**
- **WebSocket events**
- **Error codes**
- **Platform + GitHub access enforcement rules**

This API spec forms the foundation for implementing the backend.

All endpoints follow:

- **RESTful principles**
- JSON request/response bodies
- Standard error envelope
- Strong role-based access control
- MVC separation (routes ‚Üí controllers ‚Üí services)

---

# üü© **5.1 Authentication**

## **5.1.1 Login via GitHub OAuth**

Endpoint:

```
GET /auth/github
GET /auth/github/callback
```

Flow:

1. Redirect user to GitHub OAuth.
2. GitHub sends code ‚Üí backend exchanges for token.
3. Fetch:
   - GitHub ID
   - Username
   - Avatar
   - Email

4. Create or update user in DB.
5. Issue JWT (accessToken + refreshToken).

### JWT Claims:

- `userId`
- `roles`
- `githubId`
- `exp`

Secure cookie OR Authorization header allowed.

---

# üü¶ **5.2 User API**

### **GET /api/me**

Returns authenticated user profile.

### **PATCH /api/me**

Update preferences (e.g., notification settings).

### **GET /api/me/notifications**

Fetch in-app notifications.

---

# üü© **5.3 Organization API**

### **POST /api/orgs**

Create organization.

Body:

- name
- logo (optional)
- description (optional)

### **GET /api/orgs/:id**

Fetch organization detail (if user is member).

### **GET /api/orgs/:id/members**

List all members.

### **POST /api/orgs/:id/invite**

Invite user to org.

Body:

- email/githubUsername
- role (sponsor/maintainer/contributor)

### **POST /api/orgs/:id/invite/:inviteId/accept**

Accept invite.

---

# üü¶ **5.4 Project API**

### **POST /api/orgs/:id/projects**

Create project.

Body:

- title
- description
- repoUrl
- repoType (PUBLIC/PRIVATE)
- tokenAddress (null for native)
- fundingMode (ESCROW/YIELD)

### Access rules:

- Must be org member with role SPONSOR or MAINTAINER.

---

### **GET /api/projects/:id**

Project details.

### **GET /api/projects**

List user-accessible projects:

- All public projects
- All private projects they are invited to (platform + GitHub access needed)

---

### **POST /api/projects/:id/invite**

Invite contributor to project.

Backend flow:

1. Create platform invite.
2. For private repo:
   - Trigger GitHub collaborator invite via GitHub App.

Body:

- toUser (email or github username)

---

### **GET /api/projects/:id/members**

List project members.

---

### **POST /api/projects/:id/approve-structure**

Sponsor approves AI-generated structure (milestones & sub-milestones).

---

### **POST /api/projects/:id/fund/quote**

Returns:

- sum(points)
- total USDC equivalent
- token price
- required token amount
- contract addresses & instructions

### **POST /api/projects/:id/fund**

Confirms funding after wallet deposit.

Requires:

- depositTxHash

---

# üü© **5.5 Milestones API**

### **GET /api/projects/:id/milestones**

List milestones.

### **PATCH /api/milestones/:id**

Edit:

- Title
- Description
- Points
- Acceptance criteria
- Order

### **POST /api/projects/:id/generate-milestones**

Triggers Inngest workflow:

- AI milestone generation agent

Response:

- workflowId

---

# üü¶ **5.6 Sub-Milestones / Tasks API**

### **GET /api/milestones/:id/sub**

List sub-milestones.

### **GET /api/sub/:id**

View sub-milestone.

---

### **POST /api/sub/:id/claim**

Claim task.

Backend checks:

- Task is open
- Contributor role exists
- User has GitHub access (private repos)
- No conflicts

Updates:

- claimedById = userId
- status = CLAIMED

---

### **POST /api/sub/:id/link-pr**

Body:

- prUrl
- branchName

Backend:

- Validate PR authenticity
- Create entry
- Emit Kafka event `pr.linked`
- Start verification workflow

---

### **GET /api/sub/:id/progress**

Returns:

- verification state
- PR test results
- ZK proof status
- micropayment info

---

# üü© **5.7 AI Assistant API (AI Sidebar)**

### **POST /api/ai/sidebar**

Body:

- message: string
- projectId?: string
- subMilestoneId?: string
- repoContext?: boolean
- includeDocs?: boolean

Backend:

1. Build context:
   - Qdrant vectors
   - Repo embeddings
   - Milestone details
   - Task history

2. Call Vercel AI SDK
3. Stream response to UI

---

# üüß **5.8 Document API**

### **POST /api/projects/:id/documents**

Upload PDF/Text/Markdown/code.

### Flow:

1. Upload to object storage
2. Parse + chunk
3. Embed via AI SDK
4. Store embeddings in Qdrant
5. Store metadata in Postgres

---

# üü• **5.9 Verification & ZK API**

These are mostly internal (Inngest + Kafka), but some status endpoints exist.

---

### **GET /api/sub/:id/verification**

Return verification status.

---

### Internal Inngest endpoints (not exposed):

- `verification.job.created`
- `verification.job.completed`
- `zk.proof.created`
- `payment.completed`

---

# üü© **5.10 Payments API**

### **GET /api/users/:id/earnings**

Shows contributor earnings.

---

### Internal:

- `POST /api/payments/release`
  Triggered by ZK workflow only.

---

# üüß **5.11 Notification API**

### **GET /api/notifications**

List notifications.

### **POST /api/notifications/:id/read**

Mark notification as read.

### **POST /api/notifications/:id/read-all**

Mark all read.

---

# üü¶ **5.12 WebSocket Events (Socket.io)**

### Namespace: `/realtime`

Channels:

### **user:{userId}**

Events:

- `payment-received`
- `task-update`
- `invite-received`
- `repo-access-granted`
- `ai-sidebar-response`
- `verification-progress`

---

### **project:{projectId}**

Events:

- `milestone-changed`
- `contributor-joined`
- `funding-update`
- `yield-update`

---

### **task:{subMilestoneId}**

Events:

- `pr-updated`
- `verification-step`
- `zk-proof-ready`

---

# üü• **5.13 GitHub Webhooks**

Endpoint:

```
POST /webhooks/github
```

Must verify:

- Signature (HMAC)
- Installation ID

### Handled events:

- `pull_request`
- `push`
- `installation_repositories`
- `membership`
- `check_run`
- `workflow_job`

### Uses:

- Track commits
- Validate PR branches
- Start verification workflows

---

# üü• **5.14 Error Handling Standard**

All errors use:

```
{
  "error": {
    "code": "string",
    "message": "string",
    "details": {}
  }
}
```

### Error Codes:

- `UNAUTHORIZED`
- `FORBIDDEN`
- `INVALID_INPUT`
- `PROJECT_NOT_FOUND`
- `TASK_ALREADY_CLAIMED`
- `NO_REPO_ACCESS`
- `GITHUB_INVITE_PENDING`
- `AI_GENERATION_FAILED`
- `INSUFFICIENT_FUNDS`
- `VERIFICATION_FAILED`
- `PROOF_INVALID`
- `DEPOSIT_NOT_CONFIRMED`

---

# ‚úî Section 5 Completed

# **Section 6 ‚Äî Workflows & Processes**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 6 ‚Äî Workflows & Processes**
_(Part 6 ‚Äî Deep specification of every Inngest workflow, every Kafka pipeline, all sequence diagrams, AI agent logic, verification flows, ZK flows, repo invite flows, notifications, and yield flows.)_

---

# üü¶ **6.0 Overview**

This section defines **every automated process** in the system.
All automation in DevSponsor is driven by:

### **Core Automation Stack**

- **Inngest Workflows** ‚Äì Long-running, fault-tolerant tasks
- **Inngest Agent Kit** ‚Äì Stateful AI agents
- **Kafka** ‚Äì Event streaming and state synchronization
- **GitHub App Webhooks** ‚Äì PR/commit triggers
- **Smart Contract Events** ‚Äì On-chain state changes

Each workflow is:

- Idempotent
- Checkpointed
- Recoverable
- Auditable
- Versioned
- Distributed

---

# üü© **6.1 Inngest Workflows (Complete List)**

DevSponsor has **11 mission-critical Inngest workflows**.

Below is the full specification for each.

---

# üü¶ **6.1.1 Workflow 1 ‚Äî AI Milestone Generation**

### Trigger:

```
inngest.trigger("project.generateMilestones")
```

### Initiated by:

- POST /api/projects/:id/generate-milestones
- Sponsor explicitly regenerating
- AI agent auto-rescoping milestone (future)

### Inputs:

- projectId
- project description
- repo info
- uploaded documents (Qdrant chunks)
- previous milestone drafts (optional)

### Steps:

1. Fetch all context data
2. Construct system prompt
3. Query **Vercel AI SDK (Claude or OpenRouter)**
4. Stream partial output back to UI
5. Validate structured JSON using schema
6. If invalid ‚Üí fallback agent attempts self-repair
7. Save milestones (draft status)
8. Emit Kafka event `ai.milestones.generated`
9. Send notification to sponsor

### Failure Handling:

- If AI fails ‚Üí notify sponsor
- Retry 3 times with backoff
- Store both failed & successful attempts for audit

---

# üü© **6.1.2 Workflow 2 ‚Äî Project Funding Quote Calculation**

Triggered when sponsor clicks **Fund Project**.

### Trigger:

```
inngest.trigger("project.calculateFundingQuote")
```

### Steps:

1. Sum points across sub-milestones
2. Calculate USDC equivalent
3. Query Chainlink oracle for token price
4. Compute token amount required
5. Save quote record
6. Return deposit instructions to frontend

---

# üü© **6.1.3 Workflow 3 ‚Äî Project Funding Confirmation**

### Trigger:

```
inngest.trigger("project.funded")
```

### Inputs:

- depositTxHash
- projectId

### Steps:

1. Monitor blockchain for tx confirmation
2. On confirmation:
   - Update project state ‚Üí ACTIVE
   - Store FundingRecord

3. Emit event `project.funded`
4. WS notify contributors
5. Email notification sent

---

# üü¶ **6.1.4 Workflow 4 ‚Äî Contributor Claim Task Workflow**

### Trigger:

```
inngest.trigger("subtask.claimed")
```

### Inputs:

- userId
- subMilestoneId

### Steps:

1. Lock task (prevent double-claim)
2. Check GitHub access
3. If private repo & contributor lacks access:
   ‚Üí call GitHub API to automatically send collaborator invite
4. Update SubMilestone status ‚Üí CLAIMED
5. Emit Kafka event `task.claimed`
6. Real-time notification to sponsor
7. Email confirmation to contributor

---

# üü© **6.1.5 Workflow 5 ‚Äî PR Linked Workflow**

### Trigger:

```
inngest.trigger("pr.linked")
```

### Inputs:

- prUrl
- branch
- contributorId

### Steps:

1. Validate PR belongs to project repo
2. Fetch commit SHAs
3. Validate commit timestamps > claim timestamp
4. Emit Kafka event `verification.job.created`
5. Continue to Verification workflow

---

# üü• **6.1.6 Workflow 6 ‚Äî PR Verification Workflow (Test Harness Execution)**

**üö® One of the most important workflows.**

### Trigger:

```
inngest.trigger("verification.job.created")
```

### Steps:

#### **1. Setup isolated environment**

- Create deterministic environment container
- Pull repo at commit SHA
- Checkout PR branch

#### **2. Install dependencies**

- Use cached lockfiles
- Validate deterministic build

#### **3. Run verification checks**

- Unit tests
- Static analysis
- Linting
- Custom acceptance criteria (AI-generated)

#### **4. Produce verification digest**

- Test results
- File hash
- Commit metadata
- Merkle tree leaf

#### **5. Save verification artifact**

- Store raw output
- Save logs
- Store digest in DB

#### **6. Emit event**

```
verification.job.completed
```

---

# üü• **6.1.7 Workflow 7 ‚Äî ZK Proof Generation Workflow**

Triggered after verification job completes.

### Trigger:

```
inngest.trigger("zk.proof.generate")
```

### Inputs:

- verificationDigest
- subMilestoneId

### Steps:

1. Load digest
2. Load ZK circuit
3. Execute proving
4. Generate:
   - proof
   - public inputs
   - witness

5. Store ZkProof entry
6. Emit event `zk.proof.created`

#### Performance:

- Must run in < 3 minutes median
- Horizontal scaling allowed via Agent Kit

---

# üü• **6.1.8 Workflow 8 ‚Äî Micropayment Release Workflow**

### Trigger:

```
inngest.trigger("payment.release")
```

### Steps:

1. Fetch ZK proof
2. Call smart contract:
   - `releasePayment(subMilestoneId, proof)`

3. Wait for confirmation
4. Save Payment record
5. Emit Kafka event `payment.completed`
6. Notify contributor via WS and email

---

# üü© **6.1.9 Workflow 9 ‚Äî Yield Harvesting Workflow**

Runs based on schedule:

```
inngest.cron("0 */12 * * *")
```

### Steps:

1. For each project in YIELD mode:
   - Call Yield Manager contract
   - Collect yield

2. Deduct platform fee
3. Distribute:
   - Sponsor share
   - Project share (if configured)

4. Emit event `yield.harvested`
5. Send notifications
6. Update analytics

---

# üü¶ **6.1.10 Workflow 10 ‚Äî Repo Access Auto-Invite Sync**

### Trigger:

```
inngest.trigger("repo.access.sync")
```

Also triggered periodically every hour.

### Steps:

1. Check invites with status `SENT` but not accepted
2. Use GitHub API to get current status
3. If accepted ‚Üí update GitHubRepoAccess ‚Üí ACCESS_GRANTED
4. If expired ‚Üí resend invite
5. If user removed ‚Üí mark NONE

---

# üü© **6.1.11 Workflow 11 ‚Äî Notification Workflow**

Triggered by any notable event:

- funding
- payment
- invite
- PR linked
- verification update
- AI milestone finished

### Steps:

1. Save notification in DB
2. Push WS event
3. Send optional email

---

# üü¶ **6.2 Kafka Event Pipelines**

Kafka provides distributed consistency and ensures replayability.

### Event List:

| Topic                          | Purpose                       |
| ------------------------------ | ----------------------------- |
| `ai.milestones.generated`      | UI updates, audit, analytics  |
| `project.funded`               | Unlock tasks, enable claiming |
| `task.claimed`                 | Sync task boards              |
| `pr.linked`                    | Start verification            |
| `verification.job.created`     | Trigger harness               |
| `verification.job.completed`   | Trigger ZK                    |
| `zk.proof.created`             | Trigger payment               |
| `payment.completed`            | Update earnings               |
| `yield.harvested`              | Sponsor dashboard updates     |
| `repo.private.invite.required` | Auto invite                   |
| `notification.triggered`       | In-app/email notifications    |

---

# üü• **6.3 Sequence Diagrams**

Textual because of chat format.

---

## **6.3.1 AI Milestone Generation Flow**

```
Sponsor ‚Üí API ‚Üí Inngest ‚Üí AI SDK
         ‚Üí Qdrant ‚Üí AI Model ‚Üí Inngest
         ‚Üí DB ‚Üí Socket.IO ‚Üí Sponsor UI
```

---

## **6.3.2 Task Claim Flow**

```
Contributor ‚Üí API
    ‚Üí Check GitHub Access
        ‚Üí IF PRIVATE ‚Üí GitHub App Invite
    ‚Üí Update DB (status=CLAIMED)
    ‚Üí Kafka event
    ‚Üí WS notify sponsor
```

---

## **6.3.3 PR Verification ‚Üí ZK ‚Üí Payment**

```
Contributor ‚Üí Link PR
API ‚Üí Kafka(pr.linked)
Kafka ‚Üí Inngest.VerificationWorkflow
    ‚Üí Test Harness
    ‚Üí Digest
    ‚Üí Kafka(verif.completed)
Kafka ‚Üí Inngest.ZKWorkflow
    ‚Üí Generate Proof
    ‚Üí Kafka(zk.proof.created)
Kafka ‚Üí Inngest.PaymentWorkflow
    ‚Üí Smart Contract.releasePayment()
    ‚Üí Kafka(payment.completed)
API ‚Üí WebSocket Updates
```

---

## **6.3.4 Private Repo Invite Flow**

```
Sponsor ‚Üí API invite
API ‚Üí DB (platformInvite)
API ‚Üí GitHub App (collaboratorInvite)
GitHub ‚Üí Email to contributor
Contributor accepts invite
GitHub App ‚Üí Webhook ‚Üí API
API ‚Üí DB(access=granted)
WS ‚Üí Contributor UI: "Repo Access Granted"
```

---

## **6.3.5 Yield Harvest Flow**

```
Cron ‚Üí Inngest HarvestWorkflow
    ‚Üí YieldManagerContract
        ‚Üí Harvest yield
    ‚Üí Fee calculation
    ‚Üí Distribution
    ‚Üí Kafka(yield.harvested)
    ‚Üí Notifications
```

---

# ‚úî Section 6 Completed

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 7 ‚Äî Security, Compliance & SLOs**
_(Part 7 ‚Äî All security requirements, permissions, compliance, data protection, rate limits, SLO/SLA objectives.)_

---

# üõ° **7.0 Security Overview**

DevSponsor handles:

- GitHub OAuth identities
- Private repository access
- Smart contract deposits
- AI-generated milestone data
- Contributor payments
- Private documents uploaded for context

Security must be **zero-trust**, **multi-layered**, **auditable**, and **defensive-by-default**.

---

# üü© **7.1 Authentication & Authorization**

### ‚úî Authentication: GitHub OAuth + JWT

**JWT includes:**

- userId
- githubId
- roles
- issuedAt
- expiresIn

Tokens must be:

- HTTP-only if cookie based
- Rotated frequently
- Verified server-side on each request

### ‚úî Role Enforcement

Roles:

- OWNER (org owner)
- SPONSOR
- MAINTAINER
- CONTRIBUTOR
- ADMIN

Access checks enforced at the **service layer**, NOT in controllers.

### ‚úî Resource-Based Authorization

All protected entities have rule sets:

#### **Organization**

- Only OWNER/MAINTAINER can:
  - manage settings
  - invite members
  - create projects

#### **Project**

- Only sponsor/maintainer can:
  - manage milestones
  - approve structure
  - fund

#### **Sub-milestone (Tasks)**

- Only contributors who:
  - have been invited to project
  - AND have GitHub repo access
    can claim tasks.

---

# üü¶ **7.2 GitHub App Security**

GitHub App must contain:

### Permissions:

- **Contents:** Read & Write
- **Pull Requests:** Read & Write
- **Metadata:** Read
- **Checks:** Read & Write
- **Members:** Write (for collaborator invites)

### Required Webhook Signature Verification:

- HMAC SHA-256
- Compare using constant-time algorithm
- Reject if timestamp is older than 5 minutes

### Private Repo Access:

- Never rely on platform-only access
- GitHub must confirm collaborator access

### GitHub Token Handling:

- Installation access tokens must NEVER be stored
- Only request ephemeral tokens when needed
- Cache for maximum 40‚Äì60 seconds

---

# üü© **7.3 Smart Contract Security**

### Rules:

- All smart contracts required to be audited (internal or external)
- Role-based access for treasury withdrawal
- Reentrancy protection
- SafeERC20 used everywhere
- Upgradable proxy allowed only via multisig control
- Yield manager must enforce:
  - withdrawal delay
  - emergency pause

### Runtime checks:

- Validate `msg.sender` is platform worker
- Require project state ACTIVE before releasing payments

---

# üü¶ **7.4 API Security**

### Input Validation:

- Strict validation on all endpoints
- Zod or equivalent schema validation required

### Rate Limits:

- Per-user IP rate limit
- Per-project rate limit for milestone generation
- Per-user rate limit for AI sidebar prompts

### Abuse Protection:

- Block PR spam
- Reject fake PR URLs
- Detect attempts to link PRs not belonging to repo

### CSRF:

- Only JWT-based clients ‚Üí minimal CSRF surface
- For cookie-based deployments ‚Üí add CSRF token

### CORS:

- Only allow defined frontend origins
- Block wildcard origins

---

# üü© **7.5 Document Security**

Documents uploaded to platform (PDF, Markdown, etc.) must be:

- Sanitized
- Virus & malware scanned
- Stored encrypted in S3 (AES-256 SSE)
- Embedded into Qdrant vector store
- Never returned raw to other users unless authorized

---

# üü¶ **7.6 Sensitive Data Protection**

The platform stores:

- GitHub user data
- Payment records
- AI prompts + outputs
- Internal organization data

### Requirements:

- Encrypt sensitive fields (invite tokens, emails)
- Store API keys in Vault (not env variables)
- Never log sensitive data
- Redact secrets in logs

### Password storage:

- Platform does not manage passwords
- Only OAuth + JWT

---

# üü© **7.7 Workflow & Inngest Security**

### Workflow Isolation:

- Each workflow runs in isolated environment
- Retry exponential backoff
- No unbounded recursion
- Prevent replay attacks with dedupe IDs

### Agent Kit Security:

- Agents must be rate-limited
- Agents must be context bounded to avoid leaking data across projects
- All agent actions logged and auditable

---

# üü• **7.8 AI Model Security & Safety**

### Requirements:

1. **Model Call Safety**
   - Validate outputs against schemas
   - Reject hallucinated fields
   - Backoff + fallback to secondary model

2. **Prompt Injection Protection**
   - Escape user content
   - Never allow user to override system prompts
   - Maintain strict role separation between user & system roles

3. **Document Leakage Prevention**
   - Retrieval limited to project-level
   - No cross-project embeddings allowed
   - No global AI memory

4. **Structured Generation**
   - Milestones must be valid JSON
   - No free-text milestone structure allowed
   - Validators enforce type safety

---

# üü¶ **7.9 Compliance Requirements**

DevSponsor must comply with:

### ‚úî GDPR (Europe)

- Right-to-delete
- Right-to-export
- Minimal data retention

### ‚úî SOC 2 (design-level compliance)

- Logging
- Monitoring
- Access control

### ‚úî Open Source License Compliance

When handling repos, platform must enforce:

- License metadata extraction
- Potential prompts to sponsor if license conflicts

### ‚úî Tax Reporting (future)

- Payments may require 1099 forms for US
- Platform must be ready to integrate tax provider

---

# üü© **7.10 Observability & Logging**

### Logs must include:

- Correlation ID
- Request ID
- Workflow ID
- User ID
- Service name
- Error category

Use:

- Loki or Cloud Logging
- Prometheus metrics
- Grafana dashboards

---

# üüß **7.11 SLO & SLA Targets**

| Area                         | SLO                      |
| ---------------------------- | ------------------------ |
| API latency (p95)            | < 200ms                  |
| AI generation response start | < 1s                     |
| AI milestone completion      | < 20s                    |
| PR verification              | median < 2.5 mins        |
| ZK proof generation          | median < 2 mins          |
| Payment release              | < 30 seconds after proof |
| GitHub auto-invite sync      | < 10 seconds             |
| Notification delivery        | < 5 seconds              |
| Workflow failure rate        | < 0.1%                   |

### SLA (contracted)

- 99.95% uptime
- 24h max P1 incident resolution
- 48h for P2

---

# ‚úî Section 7 Completed

# **Section 8 ‚Äî Infrastructure, CI/CD & Deployment Architecture**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 8 ‚Äî Infrastructure, CI/CD & Deployment Architecture**
_(Part 8 ‚Äî Complete infra blueprint: environments, Kubernetes, CI/CD pipelines, Inngest/agents infra, secrets, observability, scaling, cost control.)_

---

# üü¶ **8.0 Infrastructure Overview**

DevSponsor backend infrastructure must support:

- AI workloads
- Inngest workflows
- ZK proof computation
- GitHub webhooks
- High-traffic APIs
- Real-time updates
- Secure smart contract interactions

The recommended architecture:

```
Cloud Provider (AWS/GCP)
 ‚îú‚îÄ Kubernetes Cluster (EKS/GKE)
 ‚îÇ   ‚îú‚îÄ API Pods
 ‚îÇ   ‚îú‚îÄ Inngest Agent Pods
 ‚îÇ   ‚îú‚îÄ Worker Pods (ZK / test harness)
 ‚îÇ   ‚îú‚îÄ WebSocket Gateway
 ‚îÇ   ‚îî‚îÄ CronPods (optional)
 ‚îú‚îÄ Postgres (RDS/CloudSQL)
 ‚îú‚îÄ Redis (Elasticache/Memorystore)
 ‚îú‚îÄ Kafka (MSK/Confluent Cloud)
 ‚îú‚îÄ Qdrant Cloud / Self-hosted Qdrant
 ‚îú‚îÄ Object Storage (S3/GCS)
 ‚îú‚îÄ Inngest Cloud
 ‚îú‚îÄ Email Provider (Resend)
 ‚îî‚îÄ API Gateway + Load Balancer
```

---

# üü© **8.1 Environment Setup**

### Environments:

- **development** (local Docker, seeded DB)
- **staging** (testing with dev GitHub App)
- **production**

### Secrets stored in:

- HashiCorp Vault
  OR
- AWS Parameter Store + Secrets Manager

Secrets include:

- GitHub App credentials
- AI provider API keys
- JWT secret
- Database credentials
- Redis/Kafka credentials
- Contract addresses
- Qdrant API key

---

# üü• **8.2 Kubernetes Architecture**

### Required deployments:

| Component               | Deployment Type       | Scaling              |
| ----------------------- | --------------------- | -------------------- |
| API server              | Deployment            | HPA (cpu/mem)        |
| WebSocket gateway       | Deployment            | HPA                  |
| Inngest Agent Kit       | Deployment            | HPA (jobs workload)  |
| PR verification runners | Job/Deployment        | On-demand scaling    |
| ZK proof generators     | Job/Deployment        | GPU-enabled optional |
| Kafka consumers         | Stateful / Deployment | Scale as needed      |
| Notifications service   | Deployment            | Light load           |

### Inngest-specific needs:

- Agents should use isolated node pools (optional)
- ZK proof workers may require:
  - GPU-enabled nodes
  - High-memory nodes

---

# üü¶ **8.3 Containerization**

All services are Dockerized.

### Recommended Docker image structure:

```
base: node:20-alpine
workdir: /app
multi-stage build:
 - install deps
 - build TS
 - prune dev deps
```

### Standardization:

- Use same base image for all services
- ZK proof worker may require a separate image (Rust + circom + snarkjs or Halo2)

---

# üüß **8.4 Networking & Load Balancing**

### External access:

- Load Balancer ‚Üí API Gateway
- Load Balancer ‚Üí WebSocket Gateway
- GitHub Webhooks: Public HTTPS endpoint required

### Internal networking:

- Cluster internal services communicate over mTLS if possible
- Redis, DB, Kafka, Qdrant protected by VPC-only access

---

# üü© **8.5 Database Infrastructure**

### Postgres:

- Recommended: RDS or CloudSQL
- Multi-AZ
- Automated backups
- PITR (Point-in-time recovery)

### Extensions:

- pgcrypto (for encrypted fields)
- pg_stat_statements

### Performance:

- Use read replicas if traffic grows
- Never store raw large documents (store in S3 instead)

---

# üü¶ **8.6 Redis Infrastructure**

Redis used for:

- cache
- pub/sub
- task locking
- rate limiting
- WebSocket presence

Recommendations:

- Redis 7
- ElastiCache or Memorystore
- Cluster mode if scaling
- TTL on all cached entries

---

# üü© **8.7 Kafka Infrastructure**

### Use:

- Confluent Cloud (recommended)
- AWS MSK (alternative)

### Requirements:

- High durability
- 3 broker minimum
- Topic compaction for certain events (like repo access status)
- Partitioning based on:
  - projectId
  - subMilestoneId

---

# üü¶ **8.8 Qdrant Infrastructure**

Options:

- Qdrant Cloud (recommended)
- Self-managed Qdrant in Kubernetes
- Single-node to start, then cluster-mode scaling

### Requirements:

- Vector index: HNSW
- Replication: 2x recommended
- Embedding dimension:
  - 1536 (OpenAI)
  - 3072 (Claude/OpenRouter)

### Security:

- Private VPC
- API key attached
- Access only from backend

---

# üüß **8.9 Object Storage**

S3 or GCS is used for:

- Document uploads
- Repo snapshot archives (optional)
- AI context files
- Logs or test artifacts (optional)

Configuration:

- Public access disabled
- Server-side encrypted
- Presigned upload URLs

---

# üü¶ **8.10 CI/CD Pipeline**

### Required pipelines:

---

## **8.10.1 Backend Pipeline (API + Services)**

Triggers:

- PR merge to main
- Manual deploy

Steps:

1. Install dependencies
2. Typecheck
3. Lint
4. Unit tests
5. Build
6. Generate Prisma migrations
7. Docker build
8. Push image
9. Deploy to Kubernetes
10. Run DB migrations (safe mode)
11. Smoke tests

---

## **8.10.2 Inngest Workflows Pipeline**

Similar to backend, but:

- Must validate workflow definitions
- Build agent images
- Register workflows with Inngest system

---

## **8.10.3 AI Prompt & Schema Validation Pipeline**

These must be version-controlled:

- System prompts
- Schema definitions (Zod)
- Prompt tests (‚Äúcontract tests‚Äù)

Automated tests validate:

- JSON generation correctness
- Hallucination prevention
- Prompt injection resistance

---

## **8.10.4 Smart Contract Pipeline (for on-chain logic)**

1. Compile
2. Run tests
3. Static analysis (Slither)
4. Deployment (Hardhat script)
5. Post-deploy verification (Etherscan)

---

# üü¶ **8.11 Monitoring & Observability Stack**

### Recommended full stack:

| Component         | Purpose                |
| ----------------- | ---------------------- |
| Prometheus        | Metrics                |
| Grafana           | Dashboards             |
| Loki              | Logs                   |
| Tempo             | Distributed tracing    |
| Inngest Dashboard | Workflow observability |
| Kafka Monitoring  | Consumer lag           |
| Sentry            | Error reporting        |
| Datadog           | Optional APM           |

### Metrics to track:

- request latency
- queue lag
- AI call duration
- ZK proof time
- test harness failures
- payment failures
- repo invite errors
- rate limit violations

---

# üüß **8.12 Scaling Strategy**

### Horizontal scaling:

- API pods
- Websocket gateway
- Inngest agents
- Kafka consumers

### Vertical scaling:

- ZK proof workers (heavy CPU/GPU)
- Test harness workers

### Trigger-based scaling:

- If Kafka lag grows ‚Üí auto-scale consumers
- If Inngest queue grows ‚Üí auto-scale agents

---

# üü¶ **8.13 Cost Controls**

### AI:

- Token usage tracking (OpenRouter bills per token)
- Model fallback to cheaper models
- AI call batching (optional)

### Test harness:

- Cache dependencies
- Use ephemeral runners
- GPU only if necessary

### Qdrant:

- Compact stale vectors
- Lower replication

### Kafka:

- Keep retention low for high-traffic topics

### Smart contracts:

- Minimize on-chain writes
- Batch yield harvesting

---

# ‚úî Section 8 Completed

# **Section 9 ‚Äî Development Milestones & Roadmap**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 9 ‚Äî Development Milestones & Roadmap**
_(Part 9 ‚Äî Full engineering build plan, milestones, team requirements, timelines, priorities, sequencing.)_

This section defines **how to actually build the entire platform step-by-step**, in a realistic engineering roadmap that an actual development team can follow.

---

# üü¶ **9.0 Overview**

DevSponsor is a **complex, multi-system platform** involving:

- AI agents
- Smart contracts
- GitHub integration
- Private repo flows
- ZK verification
- Inngest workflows
- Kafka pipelines
- Funding + payments
- Notifications
- Contributor workflows

To build everything realistically, the roadmap is divided into **4 phases**, each with multiple milestones.

The structure ensures:

- Fast early validation
- Stable infrastructure
- Gradual addition of complex systems
- Ability to onboard AI + ZK later without blocking early functionality

---

# üü© **9.1 Phase 1 ‚Äî Foundations & Developer Onboarding (Weeks 1‚Äì4)**

**Goal:** Set up the full backend foundation: auth, orgs, projects, milestones (draft), Repo integration (public only), basic notifications.

### **Milestone 1 ‚Äî Core Backend Setup (Week 1)**

Tasks:

- Setup Node + TypeScript monorepo (or single backend repo)
- Initialize Express/Fastify API skeleton
- Implement folder structure (MVC: routes ‚Üí controllers ‚Üí services)
- Integrate Prisma + Postgres schema v0
- Add Redis integration
- Add JWT authentication
- Implement GitHub OAuth
- Setup Kubernetes manifests (local dev)
- Setup CI pipeline (lint, test, build)

Deliverables:

- Auth working end-to-end
- Database migrations running
- Base API online

---

### **Milestone 2 ‚Äî Organization System (Week 2)**

Tasks:

- Org model
- Org member roles
- Org invites (platform only)
- Basic email notifications
- Org dashboard endpoints
- Unit tests

Deliverables:

- Sponsor can create org and invite members
- Members visible in dashboard

---

### **Milestone 3 ‚Äî Project System (Week 3)**

Tasks:

- Project creation API
- Repo type handling (public only)
- Token selection (UI only for now)
- Funding mode selection (data only)
- Basic milestone CRUD
- Notifications for project creation

Deliverables:

- Sponsor can create/view projects
- Project stored properly
- Repo metadata saved

---

### **Milestone 4 ‚Äî AI Sidebar (MVP Version) (Week 4)**

Tasks:

- Integrate Vercel AI SDK
- Implement AI sidebar with:
  - basic LLM context: project description + conversation history

- No Qdrant yet
- Implement streaming responses
- Enforce schema for AI messages

Deliverables:

- Sidebar working for contextual Q&A
- Placeholder AI interactions for milestone generation

---

# üü© **9.2 Phase 2 ‚Äî AI Milestones & Contributor System (Weeks 5‚Äì10)**

**Goal:** Implement AI milestones, sub-milestones, funding quote pipeline, contributor browsing, task claiming, private repo auto-invite.

---

### **Milestone 5 ‚Äî AI Milestone Generation (Weeks 5‚Äì6)**

Tasks:

- Add Qdrant setup
- Document ingestion API ‚Üí embeddings ‚Üí Qdrant
- Build Inngest milestone generation workflow
- Build AI agent with Inngest Agent Kit
- Add schema validation + fallback strategy
- CRUD for milestones + sub-milestones
- Milestone display in UI

Deliverables:

- Working AI milestone drafts
- Sponsor can edit milestones
- Sponsor can approve structure

---

### **Milestone 6 ‚Äî Funding Quote + Auto Calculation (Week 7)**

Tasks:

- Implement point ‚Üí USDC ‚Üí token conversion logic
- Integrate Chainlink price oracle
- Add FundingRecord model
- Add funding quote endpoint
- Add deposit instruction generator
- Connect to wallet (frontend)
- Monitor deposit via Inngest

Deliverables:

- No manual budget input
- Accurate token calculation
- Funding flow ready (but no contract interaction yet)

---

### **Milestone 7 ‚Äî Contributor Dashboard (Week 8)**

Tasks:

- List public projects
- Hide private projects
- Project detail view
- Display milestones + sub-milestones
- Claim task endpoint
- Task panels

Deliverables:

- Contributor can browse & claim tasks
- Sponsor gets notifications

---

### **Milestone 8 ‚Äî Private Repo Auto-Invite (Week 9)**

Tasks:

- GitHub App permissions (write access, collaborator invites)
- Project-level invite API
- Inngest workflow for sending GitHub collaborator invite
- GitHub webhook listener for invitation acceptance
- GitHubRepoAccess table
- Strict access enforcement

Deliverables:

- Contributor auto-invited to GitHub repo
- Private projects only accessible after successful GitHub invite

---

### **Milestone 9 ‚Äî PR Linking Flow (Week 10)**

Tasks:

- Link PR endpoint
- Validate repo and PR relationship
- Detect commit timestamps
- Emit `pr.linked` event
- WS notifications

Deliverables:

- Contributor can link PR to task
- System starts automated verification

---

# üü© **9.3 Phase 3 ‚Äî Verification Engine, ZK Proofs, Payments (Weeks 11‚Äì18)**

**Goal:** Implement full automated verification pipeline + smart contract payments + yield mode.\*\*

---

### **Milestone 10 ‚Äî Deterministic Test Harness (Weeks 11‚Äì12)**

Tasks:

- Build isolated runner environment
- Cache dependencies
- Run unit tests, lint, static analysis
- Generate digests (+ merkle leaves)
- Inngest workflow for verification

Deliverables:

- PRs can be automatically verified
- Verification digest stored

---

### **Milestone 11 ‚Äî ZK Proof System (Weeks 13‚Äì15)**

Tasks:

- Choose circuit framework (Halo2/Circom/Groth16)
- Prepare circuits for test execution validity
- Implement ZK proof generator worker (Inngest Agent)
- Store proof in DB
- Emit event

Deliverables:

- ZK proof for PR now generated automatically
- Proof passed & persisted

---

### **Milestone 12 ‚Äî Payment Contracts + Release (Weeks 16‚Äì17)**

Tasks:

- Implement Escrow contract
- Implement YieldManager
- Implement MicropaymentVault
- Integrate via Ethers.js backend service
- Build PaymentRelease workflow
- Payment verification + tx logging

Deliverables:

- Smart contract integrated
- Micropayments trigger after ZK proof

---

### **Milestone 13 ‚Äî Yield Mode (Week 18)**

Tasks:

- Integrate Aave/Compound adapter
- Build yield harvesting workflow
- Define fee split (platform % ‚Üí treasury)
- Display yield dashboard

Deliverables:

- Yield APY visible
- Funds earn yield
- Sponsor can see harvest history

---

# üü© **9.4 Phase 4 ‚Äî Notifications, Advanced AI, Admin Tools (Weeks 19‚Äì24)**

**Goal:** Polish UX and introduce advanced AI agent assistants.\*\*

---

### **Milestone 14 ‚Äî Notification Infrastructure (Week 19)**

Tasks:

- Notification DB model
- WebSocket pipeline
- Notification types (PR, payment, invite)
- Email + in-app
- Notification center UI

Deliverables:

- Multi-channel notifications fully functional

---

### **Milestone 15 ‚Äî Advanced AI Sidebar Agent (Weeks 20‚Äì21)**

Tasks:

- Add deep Qdrant integration
- Add repo embeddings
- PR diff reasoning
- Acceptance criteria explanation
- Suggestion-based rescoping

Deliverables:

- Sidebar becomes a true AI developer assistant

---

### **Milestone 16 ‚Äî Admin Dashboard (Weeks 22‚Äì23)**

Tasks:

- View users
- Audit logs
- Platform fees
- Project health metrics
- Workflow failures (from Inngest)
- Feature flags

Deliverables:

- Internal control panel for running the platform

---

### **Milestone 17 ‚Äî Performance & Security Hardening (Week 24)**

Tasks:

- Load testing
- Rate limiting updates
- Security penetration tests
- ZK proof benchmarks
- Optimize Qdrant memory usage

Deliverables:

- Platform ready for real production traffic

---

# üü© **9.5 Team Roles & Responsibilities**

### **Backend Engineer (3‚Äì5)**

- API
- Databases
- Kafka
- Redis
- GitHub integration

### **AI Engineer (2)**

- AI agent workflows
- Prompt engineering
- Qdrant pipeline
- Milestone generator tuning

### **Smart Contract Engineer (1‚Äì2)**

- Escrow
- Yield manager
- ZK verifier

### **Inngest / Distributed Systems Engineer (1‚Äì2)**

- Workflow orchestration
- Agents
- Idempotency

### **DevOps Engineer (1‚Äì2)**

- Kubernetes
- CI/CD
- Monitoring

### **Frontend Engineers (3‚Äì5)**

- Sponsor/Contributor dashboards
- AI sidebar
- Task workbenches

---

# üü© **9.6 Feature Prioritization Matrix**

| Feature                          | Priority   | Notes                |
| -------------------------------- | ---------- | -------------------- |
| AI milestone generator           | üî• Highest | Core value           |
| Treatment of private repos       | üî• Highest | Security-critical    |
| PR ‚Üí Verification ‚Üí ZK ‚Üí Payment | üî• Highest | Core innovation      |
| AI sidebar                       | High       | Productivity         |
| Funding + contracts              | High       | Required             |
| Yield mode                       | Medium     | Nice-to-have early   |
| Admin dashboard                  | Medium     | Operationally needed |
| Chat & messaging                 | Low        | Possibly future      |

---

# üü¶ **9.7 Estimated Timeline Summary**

| Phase     | Duration                 |
| --------- | ------------------------ |
| Phase 1   | 4 weeks                  |
| Phase 2   | 6 weeks                  |
| Phase 3   | 8 weeks                  |
| Phase 4   | 6 weeks                  |
| **Total** | **24 weeks (~6 months)** |

A fast + well-coordinated team can finish in ~4 months.

---

# ‚úî Section 9 Completed

# **Section 10 ‚Äî Risk Analysis, Edge Cases & Future Extensions**

# üìò **DevSponsor ‚Äì Enterprise Technical PRD**

**Section 10 ‚Äî Risk Analysis, Edge Cases & Future Extensions**
_(Final section ‚Äî identifies technical risks, UX risks, system-level weaknesses, mitigations, and long-term roadmap opportunities.)_

---

# üü• **10.0 Overview**

This section analyzes:

- Engineering risks
- Product risks
- Security risks
- AI safety risks
- Infrastructure risks
- GitHub integration risks
- ZK verification risks
- On-chain payment risks

Along with **full mitigation plans** and future opportunities once the core platform is stable.

---

# üü• **10.1 Major Engineering Risks & Mitigations**

## **10.1.1 Risk: Deterministic Test Harness Inconsistency**

Cause:

- Dependency mismatch
- Flaky tests
- Non-deterministic code

Mitigation:

- Use pinned Docker images
- Lock dependency versions
- Cache node_modules & build artifacts
- Forbid PRs that add nondeterministic logic
- Use ‚Äúsnapshot test mode‚Äù where applicable

---

## **10.1.2 Risk: AI Milestones Too Vague or Wrong**

Cause:

- AI hallucination
- Poor prompt context
- Incorrect document parsing

Mitigation:

- Strict JSON schema validation
- Multi-pass generation (generate ‚Üí critique ‚Üí refine)
- Human editing required before approval
- Qdrant context ranking
- Model fallback sequence (Claude ‚Üí OpenRouter mix ‚Üí local LLM)

---

## **10.1.3 Risk: GitHub App permissions misconfiguration**

Cause:

- Missing ‚ÄúAdd collaborator‚Äù permission
- Incorrect webhook configuration

Mitigation:

- GitHub App audit script in CI
- Automated GitHub API health checker
- Periodic repo access sync workflow

---

## **10.1.4 Risk: ZK Proof Generation Takes Too Long**

Cause:

- Circuit complexity
- Low-performance worker nodes

Mitigation:

- GPU-enabled workers (optional)
- Snark-friendly test harness design
- Limit CI complexity in tasks
- Reduce circuit constraints

---

## **10.1.5 Risk: Inngest Workflows Fail or Retry Loops**

Cause:

- Bad external dependencies
- Misconfigured agent
- Race conditions

Mitigation:

- Idempotency keys
- Workflow versioning
- Sentry error pipelines
- Dead letter queues for Kafka

---

## **10.1.6 Risk: Funding or Payment Contract Errors**

Cause:

- Wrong contract address
- Incorrect token decimals
- Oracle price issues

Mitigation:

- Contract address registry
- Pre-flight contract call tests
- Oracle fallback (median price of multiple feeds)

---

# üü• **10.2 Security & Compliance Risks**

## **10.2.1 Private Repo Access Leak**

Cause:

- Misconfigured GitHub collaborator invitation
- Incorrect access caching

Mitigation:

- Always validate GitHub access **in real-time**
- Deny task claiming until both platform + GitHub access is confirmed
- GitHub webhook cross-verification

---

## **10.2.2 AI Leaking Private Data Across Projects**

Cause:

- Wrong Qdrant filtering
- Bad prompt context logic

Mitigation:

- Strict namespace isolation in vector DB
- Per-project Qdrant collection or key prefix
- AI wrapper sanitizes retrieved context

---

## **10.2.3 Unauthorized Micropayments**

Cause:

- Forged ZK proof
- Incorrect verification in smart contract

Mitigation:

- Circuit audits
- Contract audits
- Explicit proof validity checks
- Multi-sig controlled upgradeability

---

## **10.2.4 Social Engineering Attacks**

Cause:

- Fake project invites
- Malicious PR links

Mitigation:

- Outbound email DKIM/SPF
- Validation of repo origin for PR
- Task ownership checks

---

# üü• **10.3 Performance Risks**

## **10.3.1 AI Sidebar Latency Issues**

Cause:

- Large context
- Slow embedding search
- Slow model response

Mitigation:

- Cache prompts
- Re-rank Qdrant results
- Stream responses to UI immediately

---

## **10.3.2 Kafka Consumer Lag**

Cause:

- High traffic
- Slow consumers

Mitigation:

- Auto-scaling consumers
- Partition per project

---

## **10.3.3 ZK Proof Bottleneck**

Cause:

- Limited CPU/GPU resources
- High computational load

Mitigation:

- Auto-scale ZK workers
- Pre-generate partial witness structures

---

# üü• **10.4 UX Risks**

## **10.4.1 Sponsor Confusion About Automatic Pricing**

Cause:

- No manual budget field may feel unusual

Mitigation:

- Clear UI explaining:
  ‚ÄúYour payment amount is linked to the complexity points of milestones.‚Äù
- Allow expand/collapse view of cost breakdown

---

## **10.4.2 Contributor Confusion in Verification Flow**

Cause:

- Test harness + ZK pipeline is complex

Mitigation:

- Add AI explanations in task workbench
- ‚ÄúExplain verification step‚Äù button
- Visual timeline with icons:
  ‚Üí ‚ÄúRunning tests‚Äù
  ‚Üí ‚ÄúGenerating proof‚Äù
  ‚Üí ‚ÄúReleasing payment‚Äù

---

# üü• **10.5 Edge Cases**

## **10.5.1 Contributor invited but GitHub invite pending**

Platform must:

- Show ‚ÄúPending GitHub Access‚Äù
- Deny task claiming
- Resend invitation automatically via Inngest

---

## **10.5.2 PR created BEFORE claim**

System must reject:

```
TaskError: PR contains commits older than claim timestamp
```

---

## **10.5.3 Sponsor switches repo from public ‚Üí private**

System must:

- Remove all contributors who lack private access
- Re-initiate collaborator invites

---

## **10.5.4 Payment executed but event not delivered**

System must:

- Sync chain events after delay
- Verify payment record
- Send missed notification

---

## **10.5.5 AI fails to generate valid milestones**

Fallback:

1. Retry generation
2. Use simpler model
3. Use milestone template library
4. Ask sponsor to adjust prompt

---

# üü• **10.6 Future Extensions (Long-Term Roadmap)**

These are **not part of this PRD**, but represent future opportunities.

---

## **10.6.1 Multi-Chain Support**

- Polygon
- Base
- Avalanche
- Solana (bridge)

---

## **10.6.2 AI Code Review Agent**

- Suggest fixes
- Apply patches
- Run static analysis

---

## **10.6.3 Smart Project Matching**

Use embeddings to automatically match contributors to open tasks.

---

## **10.6.4 Contributor Reputation System**

- Historical task success rate
- ZK-based attestation of work history
- NFT-based identity/trust

---

## **10.6.5 Escrow Insurance Layer**

Sponsors can add protection for unverified work.

---

## **10.6.6 AI-Based "Workload Balancer" for Sponsors**

Detect:

- Under-scoped tasks
- Over-scoped tasks
- Cost inconsistencies

---

## **10.6.7 Advanced Yield Products**

- Staking derivatives
- Partner yield pools
- Cross-chain liquidity aggregation

---

## **10.6.8 In-App Team Chat & PR Discussions**

Not needed initially, but valuable later.

---

# üü© **10.7 Final Master Risk: System Complexity**

DevSponsor involves **10+ integrated subsystems**.
Failure of one subsystem must **not** halt the entire platform.

### Mitigation:

- Event-driven patterns (Kafka)
- Workflow orchestration (Inngest)
- Retry + backoff
- Circuit breakers
- Graceful degradation
- Clear modular boundaries

---

# üéâ **PRD Completed**

You now have the **full enterprise-grade technical PRD**, including:

‚úî Section 1 ‚Äî Executive Summary
‚úî Section 2 ‚Äî System Architecture
‚úî Section 3 ‚Äî Functional Requirements
‚úî Section 4 ‚Äî Data Models & ERD
‚úî Section 5 ‚Äî API Specifications
‚úî Section 6 ‚Äî Workflows & Processes
‚úî Section 7 ‚Äî Security & SLOs
‚úî Section 8 ‚Äî Infrastructure & Deployment
‚úî Section 9 ‚Äî Roadmap & Engineering Plan
‚úî Section 10 ‚Äî Risk Analysis & Future Extensions

This is now a **complete, production-ready blueprint** that a full engineering team can use to build DevSponsor end-to-end.

---
